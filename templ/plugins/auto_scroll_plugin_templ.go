// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.977
package plugins

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import (
	"github.com/labstack/echo/v4"
	"github.com/yumenaka/comigo/config"
	"strings"
)

// AutoScrollPlugin 自动滚动插件（仅支持滚动模式）
func AutoScrollPlugin(c echo.Context) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		if config.GetCfg().EnablePlugin && config.GetCfg().IsPluginEnabled("auto_scroll") && strings.HasPrefix(c.Request().URL.Path, "/scroll/") {
			if config.GetCfg().Debug {
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<script>\n\t\t\t\tconsole.log(\"自动滚动插件已启用\");\n\t\t\t</script>")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, " <div x-data=\"{ \n\t\t\t\tautoScrollEnabled: false, \n\t\t\t\tautoScrollInterval: null,\n\t\t\t\tintervalSeconds: $persist(3).as('autoScrollIntervalSeconds'),\n\t\t\t\tshowIntervalInput: false,\n\t\t\t\tisDragging: false,\n\t\t\t\tstartX: 0,\n\t\t\t\tstartY: 0,\n\t\t\t\toffsetX: 0,\n\t\t\t\toffsetY: 0,\n\t\t\t\tleft: $persist('auto').as('autoScrollPluginLeft'),\n\t\t\t\ttop: $persist('auto').as('autoScrollPluginTop'),\n\t\t\t\tisHovered: false,\n\t\t\t\tlastInteractionTime: Date.now(),\n\t\t\t\topacityTimer: null,\n\t\t\t\tupdateOpacity() {\n\t\t\t\t\tconst now = Date.now();\n\t\t\t\t\tconst timeSinceInteraction = now - this.lastInteractionTime;\n\t\t\t\t\t// 如果鼠标悬停或距离最后交互时间小于3秒，则不透明；否则50%透明度\n\t\t\t\t\tif (this.isHovered || timeSinceInteraction < 3000) {\n\t\t\t\t\t\t$el.style.opacity = '1';\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$el.style.opacity = '0.5';\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresetInteraction() {\n\t\t\t\t\tthis.lastInteractionTime = Date.now();\n\t\t\t\t\tthis.updateOpacity();\n\t\t\t\t},\n\t\t\t\tstartAutoScroll() {\n\t\t\t\t\tconst self = this;\n\t\t\t\t\t// 清除旧定时器\n\t\t\t\t\tif (self.autoScrollInterval) {\n\t\t\t\t\t\tclearInterval(self.autoScrollInterval);\n\t\t\t\t\t\tself.autoScrollInterval = null;\n\t\t\t\t\t}\n\t\t\t\t\t// 确保使用最新的 intervalSeconds 值\n\t\t\t\t\tconst currentInterval = parseInt(self.intervalSeconds) || 3;\n\t\t\t\t\t// 滚动模式：自动向下滚动\n\n\t\t\t\t\tself.autoScrollInterval = setInterval(() => {\n\t\t\t\t\t\t// 检查是否到达页面底部\n\t\t\t\t\t\tconst scrollHeight = document.documentElement.scrollHeight;\n\t\t\t\t\t\tconst scrollTop = window.scrollY || document.documentElement.scrollTop;\n\t\t\t\t\t\tconst clientHeight = window.innerHeight;\n\t\t\t\t\t\tconst scrollStep = window.innerHeight * 9 / 10; // 每次滚 90% 屏幕高度\n\t\t\t\t\t\tif (scrollTop + clientHeight >= scrollHeight - 10) {\n\t\t\t\t\t\t\t// 到达底部，自动停止\n\t\t\t\t\t\t\tclearInterval(self.autoScrollInterval);\n\t\t\t\t\t\t\tself.autoScrollEnabled = false;\n\t\t\t\t\t\t\tself.autoScrollInterval = null;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// 继续向下滚动\n\t\t\t\t\t\t\twindow.scrollBy({\n\t\t\t\t\t\t\t\ttop: scrollStep,\n\t\t\t\t\t\t\t\tbehavior: 'smooth'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}, currentInterval * 1000);\n\t\t\t\t}\n\t\t\t}\" x-init=\"(() => {\n\t\t\t\t// 确保 intervalSeconds 是数字类型\n\t\t\t\tif (typeof intervalSeconds !== 'number') {\n\t\t\t\t\tintervalSeconds = parseInt(intervalSeconds) || 3;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 初始化位置：如果未设置过，默认在右上角\n\t\t\t\tif (left === 'auto' || top === 'auto') {\n\t\t\t\t\t// 延迟设置，确保页面已加载\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tconst rect = $el.getBoundingClientRect();\n\t\t\t\t\t\tleft = (window.innerWidth - rect.width - 16) + 'px';\n\t\t\t\t\t\ttop = 16 + 'px';\n\t\t\t\t\t}, 100);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 设置透明度定时器，每100ms检查一次\n\t\t\t\topacityTimer = setInterval(() => {\n\t\t\t\t\tupdateOpacity();\n\t\t\t\t}, 100);\n\t\t\t\t\n\t\t\t\t// 页面卸载时清理定时器\n\t\t\t\twindow.addEventListener('beforeunload', () => {\n\t\t\t\t\tif (autoScrollInterval) {\n\t\t\t\t\t\tclearInterval(autoScrollInterval);\n\t\t\t\t\t}\n\t\t\t\t\tif (opacityTimer) {\n\t\t\t\t\t\tclearInterval(opacityTimer);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t})()\" @mouseenter=\"\n\t\t\t\tisHovered = true;\n\t\t\t\tshowIntervalInput = true;\n\t\t\t\tresetInteraction();\n\t\t\t\" @mouseleave=\"\n\t\t\t\tisHovered = false;\n\t\t\t\tif (!isDragging) {\n\t\t\t\t\tshowIntervalInput = false;\n\t\t\t\t}\n\t\t\t\tresetInteraction();\n\t\t\t\" @click=\"resetInteraction()\" @mousemove=\"\n\t\t\t\tresetInteraction();\n\t\t\t\tif (isDragging) {\n\t\t\t\t\tconst newLeft = $event.clientX - offsetX;\n\t\t\t\t\tconst newTop = $event.clientY - offsetY;\n\t\t\t\t\t\n\t\t\t\t\t// 限制在视口内\n\t\t\t\t\tconst maxLeft = window.innerWidth - $el.offsetWidth;\n\t\t\t\t\tconst maxTop = window.innerHeight - $el.offsetHeight;\n\t\t\t\t\t\n\t\t\t\t\tleft = Math.max(0, Math.min(newLeft, maxLeft)) + 'px';\n\t\t\t\t\ttop = Math.max(0, Math.min(newTop, maxTop)) + 'px';\n\t\t\t\t}\n\t\t\t\" @mouseup=\"isDragging = false\" :style=\"{ left: left, top: top, bottom: left === 'auto' ? 'auto' : 'unset', right: left === 'auto' ? 'auto' : 'unset' }\" class=\"comigo_plugin fixed z-50 w-32 flex flex-col justify-center items-center gap-2\"><!-- 拖动按钮 --><button @mousedown.stop=\"\n\t\t\t\t\tresetInteraction();\n\t\t\t\t\tisDragging = true;\n\t\t\t\t\tstartX = $event.clientX;\n\t\t\t\t\tstartY = $event.clientY;\n\t\t\t\t\tconst rect = $el.closest('[x-data]').getBoundingClientRect();\n\t\t\t\t\toffsetX = startX - rect.left;\n\t\t\t\t\toffsetY = startY - rect.top;\n\t\t\t\t\" class=\"flex items-center justify-center w-1/2 px-2 py-2 text-xs text-base-content bg-base-300 bg-opacity-80 rounded cursor-move hover:bg-opacity-100 select-none border\" :x-title=\"i18next.t('auto_flip_drag_panel')\"><span class=\"mr-1\">⋮⋮</span> <span class=\"text-xs\" x-text=\"i18next.t('auto_flip_drag')\">拖动</span></button><!-- 自动滚动控制按钮（默认隐藏，hover或点击时显示） --><button x-show=\"showIntervalInput && !autoScrollEnabled\" x-transition @click=\"\n\t\t\t\t\tresetInteraction();\n\t\t\t\t\tshowIntervalInput = true;\n\t\t\t\t\tautoScrollEnabled = true;\n\t\t\t\t\tstartAutoScroll();\n\t\t\t\t\" class=\"w-full px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 focus:ring-4 focus:outline-none focus:ring-green-300 shadow-lg border\"><span x-text=\"i18next.t('auto_flip_start_scroll')\"></span></button> <button x-show=\"showIntervalInput && autoScrollEnabled\" x-transition @click=\"\n\t\t\t\t\tresetInteraction();\n\t\t\t\t\tshowIntervalInput = true;\n\t\t\t\t\tif (autoScrollInterval) {\n\t\t\t\t\t\tclearInterval(autoScrollInterval);\n\t\t\t\t\t\tautoScrollInterval = null;\n\t\t\t\t\t}\n\t\t\t\t\tautoScrollEnabled = false;\n\t\t\t\t\" class=\"w-full px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 focus:ring-4 focus:outline-none focus:ring-red-300 shadow-lg\"><span x-text=\"i18next.t('auto_flip_pause_scroll')\"></span></button><!-- 间隔时间设置（默认隐藏，hover或点击时显示） --><div x-show=\"showIntervalInput\" x-transition class=\"w-full flex flex-row items-center gap-2 px-3 py-2 text-xs bg-base-200 bg-opacity-80 rounded shadow border\"><label class=\"text-base-content\" x-text=\"i18next.t('auto_flip_interval')\">间隔:</label> <input type=\"number\" min=\"1\" max=\"60\" x-model.number=\"intervalSeconds\" @input=\"\n\t\t\t\t\t\tresetInteraction();\n\t\t\t\t\t\tintervalSeconds = parseInt($event.target.value) || 3;\n\t\t\t\t\t\t// 如果正在运行，重新启动定时器以应用新的间隔时间\n\t\t\t\t\t\tif (autoScrollEnabled) {\n\t\t\t\t\t\t\tstartAutoScroll();\n\t\t\t\t\t\t}\n\t\t\t\t\t\" class=\"w-16 px-2 py-1 text-center border border-gray-400 rounded bg-base-100 text-base-content\"> <span class=\"text-base-content\" x-text=\"i18next.t('auto_flip_seconds')\">秒</span></div></div><style>\n\t\t\t/* 确保按钮和输入框可以正常交互 */\n\t\t\t.fixed button:not(:first-child),\n\t\t\t.fixed input {\n\t\t\t\tpointer-events: auto;\n\t\t\t\tcursor: pointer;\n\t\t\t}\n\t\t\t.fixed input {\n\t\t\t\tcursor: text;\n\t\t\t}\n\t\t\t.fixed button:first-child {\n\t\t\t\tcursor: move;\n\t\t\t}\n\t\t</style>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
