// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.977
package plugins

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import (
	"github.com/labstack/echo/v4"
	"github.com/yumenaka/comigo/config"
	"strings"
)

// sketchPracticeScriptHandle 用于防止 JS 代码重复渲染
var sketchPracticeScriptHandle = templ.NewOnceHandle()

// SketchPracticeScript 初始化 Alpine.js store（只渲染一次）
func SketchPracticeScript() templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Var2 := templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
			templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
			templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
			if !templ_7745c5c3_IsBuffer {
				defer func() {
					templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err == nil {
						templ_7745c5c3_Err = templ_7745c5c3_BufErr
					}
				}()
			}
			ctx = templ.InitializeContext(ctx)
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<script>\n\t\t\t// 初始化速写练习 Alpine store\n\t\t\tdocument.addEventListener(\"alpine:init\", () => {\n\t\t\t\tAlpine.store(\"sketchPractice\", {\n\t\t\t\t\tenabled: false,\n\t\t\t\t\tsketchInterval: null,\n\t\t\t\t\tcountdownInterval: null,\n\t\t\t\t\tintervalSeconds: Alpine.$persist(30).as(\n\t\t\t\t\t\t\"sketchPracticeIntervalSeconds\",\n\t\t\t\t\t),\n\t\t\t\t\tremainingSeconds: 0,\n\t\t\t\t\t// 可拖动浮层位置\n\t\t\t\t\tfloatX: Alpine.$persist(20).as(\"sketchPracticeFloatX\"),\n\t\t\t\t\tfloatY: Alpine.$persist(20).as(\"sketchPracticeFloatY\"),\n\t\t\t\t\tisDragging: false,\n\t\t\t\t\tdragOffsetX: 0,\n\t\t\t\t\tdragOffsetY: 0,\n\n\t\t\t\t\tstart() {\n\t\t\t\t\t\tconst self = this;\n\t\t\t\t\t\t// 清除旧定时器\n\t\t\t\t\t\tif (self.sketchInterval) {\n\t\t\t\t\t\t\tclearInterval(self.sketchInterval);\n\t\t\t\t\t\t\tself.sketchInterval = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (self.countdownInterval) {\n\t\t\t\t\t\t\tclearInterval(self.countdownInterval);\n\t\t\t\t\t\t\tself.countdownInterval = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// 确保使用最新的 intervalSeconds 值\n\t\t\t\t\t\tconst currentInterval = parseInt(self.intervalSeconds) || 30;\n\t\t\t\t\t\tself.remainingSeconds = currentInterval;\n\n\t\t\t\t\t\t// 倒计时更新（每秒）\n\t\t\t\t\t\tself.countdownInterval = setInterval(() => {\n\t\t\t\t\t\t\tif (self.remainingSeconds > 0) {\n\t\t\t\t\t\t\t\tself.remainingSeconds--;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 1000);\n\n\t\t\t\t\t\t// 翻页模式：调用翻页函数\n\t\t\t\t\t\tif (typeof toNextPage === \"function\") {\n\t\t\t\t\t\t\tself.sketchInterval = setInterval(() => {\n\t\t\t\t\t\t\t\tconst nowPageNum = parseInt(Alpine.store(\"global\").nowPageNum);\n\t\t\t\t\t\t\t\tconst allPageNum = parseInt(Alpine.store(\"global\").allPageNum);\n\t\t\t\t\t\t\t\tif (nowPageNum >= allPageNum) {\n\t\t\t\t\t\t\t\t\t// 到达最后一页，自动停止\n\t\t\t\t\t\t\t\t\tself.stop();\n\t\t\t\t\t\t\t\t\tself.enabled = false;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttoNextPage();\n\t\t\t\t\t\t\t\t\t// 重置倒计时\n\t\t\t\t\t\t\t\t\tself.remainingSeconds = currentInterval;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, currentInterval * 1000);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tstop() {\n\t\t\t\t\t\tif (this.sketchInterval) {\n\t\t\t\t\t\t\tclearInterval(this.sketchInterval);\n\t\t\t\t\t\t\tthis.sketchInterval = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (this.countdownInterval) {\n\t\t\t\t\t\t\tclearInterval(this.countdownInterval);\n\t\t\t\t\t\t\tthis.countdownInterval = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.remainingSeconds = 0;\n\t\t\t\t\t},\n\n\t\t\t\t\ttoggle() {\n\t\t\t\t\t\tif (this.enabled) {\n\t\t\t\t\t\t\tthis.stop();\n\t\t\t\t\t\t\tthis.enabled = false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.enabled = true;\n\t\t\t\t\t\t\tthis.start();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tupdateInterval(value) {\n\t\t\t\t\t\tthis.intervalSeconds = parseInt(value) || 30;\n\t\t\t\t\t\tif (this.enabled) {\n\t\t\t\t\t\t\tthis.start();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\t// 拖动相关方法\n\t\t\t\t\tstartDrag(e) {\n\t\t\t\t\t\tthis.isDragging = true;\n\t\t\t\t\t\tconst clientX = e.touches ? e.touches[0].clientX : e.clientX;\n\t\t\t\t\t\tconst clientY = e.touches ? e.touches[0].clientY : e.clientY;\n\t\t\t\t\t\tthis.dragOffsetX = clientX - this.floatX;\n\t\t\t\t\t\tthis.dragOffsetY = clientY - this.floatY;\n\t\t\t\t\t},\n\n\t\t\t\t\tonDrag(e) {\n\t\t\t\t\t\tif (!this.isDragging) return;\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tconst clientX = e.touches ? e.touches[0].clientX : e.clientX;\n\t\t\t\t\t\tconst clientY = e.touches ? e.touches[0].clientY : e.clientY;\n\t\t\t\t\t\tthis.floatX = clientX - this.dragOffsetX;\n\t\t\t\t\t\tthis.floatY = clientY - this.dragOffsetY;\n\t\t\t\t\t},\n\n\t\t\t\t\tendDrag() {\n\t\t\t\t\t\tthis.isDragging = false;\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\t// 全局拖动事件监听\n\t\t\t\tdocument.addEventListener(\"mousemove\", (e) => {\n\t\t\t\t\tconst store = Alpine.store(\"sketchPractice\");\n\t\t\t\t\tif (store && store.isDragging) {\n\t\t\t\t\t\tstore.onDrag(e);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tdocument.addEventListener(\"mouseup\", () => {\n\t\t\t\t\tconst store = Alpine.store(\"sketchPractice\");\n\t\t\t\t\tif (store) store.endDrag();\n\t\t\t\t});\n\t\t\t\tdocument.addEventListener(\n\t\t\t\t\t\"touchmove\",\n\t\t\t\t\t(e) => {\n\t\t\t\t\t\tconst store = Alpine.store(\"sketchPractice\");\n\t\t\t\t\t\tif (store && store.isDragging) {\n\t\t\t\t\t\t\tstore.onDrag(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{ passive: false },\n\t\t\t\t);\n\t\t\t\tdocument.addEventListener(\"touchend\", () => {\n\t\t\t\t\tconst store = Alpine.store(\"sketchPractice\");\n\t\t\t\t\tif (store) store.endDrag();\n\t\t\t\t});\n\n\t\t\t\t// 页面卸载时清理定时器\n\t\t\t\twindow.addEventListener(\"beforeunload\", () => {\n\t\t\t\t\tconst store = Alpine.store(\"sketchPractice\");\n\t\t\t\t\tif (store) store.stop();\n\t\t\t\t});\n\t\t\t});\n\t\t</script>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			return nil
		})
		templ_7745c5c3_Err = sketchPracticeScriptHandle.Once().Render(templ.WithChildren(ctx, templ_7745c5c3_Var2), templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

// SketchPracticeOverlay 可拖动的倒计时浮层（渲染在页面顶层）
func SketchPracticeOverlay(c echo.Context) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var3 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var3 == nil {
			templ_7745c5c3_Var3 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		if config.GetCfg().EnablePlugin && config.GetCfg().IsPluginEnabled("sketch_practice") && strings.HasPrefix(c.Request().URL.Path, "/flip/") {
			templ_7745c5c3_Err = SketchPracticeScript().Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, " <!-- 可拖动的倒计时浮层 --> <div x-data x-show=\"$store.sketchPractice && $store.sketchPractice.enabled && $store.sketchPractice.remainingSeconds > 0\" x-transition :style=\"$store.sketchPractice ? 'left: ' + $store.sketchPractice.floatX + 'px; top: ' + $store.sketchPractice.floatY + 'px;' : ''\" @mousedown=\"$store.sketchPractice.startDrag($event)\" @touchstart=\"$store.sketchPractice.startDrag($event)\" class=\"fixed z-9999 px-4 py-2 bg-black/70 text-white rounded-lg cursor-move select-none shadow-lg\" style=\"touch-action: none;\"><div class=\"text-center\"><div class=\"text-3xl font-bold\" x-text=\"$store.sketchPractice ? $store.sketchPractice.remainingSeconds : ''\"></div><div class=\"text-xs opacity-80\" x-text=\"i18next.t('sketch_practice_countdown')\"></div></div></div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
		}
		return nil
	})
}

// SketchPracticePlugin 速写练习插件控制面板（仅支持翻页模式）
// 与自动翻页插件功能相同，但会在画面上显示可拖动的倒计时提示
func SketchPracticePlugin(c echo.Context) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var4 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var4 == nil {
			templ_7745c5c3_Var4 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		if config.GetCfg().EnablePlugin && config.GetCfg().IsPluginEnabled("sketch_practice") && strings.HasPrefix(c.Request().URL.Path, "/flip/") {
			if config.GetCfg().Debug {
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 3, "<script>\n\t\t\t\tconsole.log(\"Sketch practice plugin enabled\");\n\t\t\t</script>")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 4, " ")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = SketchPracticeScript().Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 5, " <div x-data class=\"w-full comigo_plugin\"><!-- 速写练习切换按钮 --><button type=\"button\" @click=\"$store.sketchPractice.toggle()\" :class=\"$store.sketchPractice && $store.sketchPractice.enabled ? 'bg-orange-400 hover:bg-orange-500' : 'bg-purple-300 hover:bg-purple-400'\" class=\"w-full mb-2 text-sm text-center inline-flex items-center justify-center px-2.5 py-2 border rounded text-black font-semibold focus:outline-none focus:ring transition delay-150 duration-300 ease-in-out \"><span x-text=\"$store.sketchPractice && $store.sketchPractice.enabled ? i18next.t('sketch_practice_pause') : i18next.t('sketch_practice_start')\"></span></button><!-- 间隔时间设置 --><div class=\"relative w-full my-2 border-2 border-gray-500 dark:border-gray-200 rounded px-2 py-1.5\"><label for=\"sketchPracticeIntervalSeconds\" class=\"block w-full mb-0 font-medium\" x-text=\"i18next.t('auto_flip_interval') + ' ' + ($store.sketchPractice ? $store.sketchPractice.intervalSeconds : 30) + ' ' + i18next.t('auto_flip_seconds')\"></label> <input id=\"sketchPracticeIntervalSeconds\" type=\"range\" min=\"5\" max=\"300\" :value=\"$store.sketchPractice ? $store.sketchPractice.intervalSeconds : 30\" @input=\"$store.sketchPractice.updateInterval($event.target.value)\" step=\"5\" class=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700\"></div></div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
