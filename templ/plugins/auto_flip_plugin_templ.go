// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.977
package plugins

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import (
	"github.com/labstack/echo/v4"
	"github.com/yumenaka/comigo/config"
	"strings"
)

// AutoFlipPlugin 自动翻页插件（仅支持翻页模式）
func AutoFlipPlugin(c echo.Context) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		if config.GetCfg().EnablePlugin && config.GetCfg().IsPluginEnabled("auto_flip") && strings.HasPrefix(c.Request().URL.Path, "/flip/") {
			if config.GetCfg().Debug {
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<script>\n\t\t\t\tconsole.log(\"Auto flip plugin enabled\");\n\t\t\t</script>")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, " <div x-data=\"{ \n\t\t\t\tautoFlipEnabled: false, \n\t\t\t\tautoFlipInterval: null,\n\t\t\t\tintervalSeconds: $persist(3).as('autoFlipIntervalSeconds'),\n\t\t\t\tstartAutoFlip() {\n\t\t\t\t\tconst self = this;\n\t\t\t\t\t// 清除旧定时器\n\t\t\t\t\tif (self.autoFlipInterval) {\n\t\t\t\t\t\tclearInterval(self.autoFlipInterval);\n\t\t\t\t\t\tself.autoFlipInterval = null;\n\t\t\t\t\t}\n\t\t\t\t\t// 确保使用最新的 intervalSeconds 值\n\t\t\t\t\tconst currentInterval = parseInt(self.intervalSeconds) || 3;\n\t\t\t\t\t// 翻页模式：调用翻页函数\n\t\t\t\t\tif (typeof toNextPage === 'function') {\n\t\t\t\t\t\tself.autoFlipInterval = setInterval(() => {\n\t\t\t\t\t\t\tconst nowPageNum = parseInt(Alpine.store('global').nowPageNum);\n\t\t\t\t\t\t\tconst allPageNum = parseInt(Alpine.store('global').allPageNum);\n\t\t\t\t\t\t\tif (nowPageNum >= allPageNum) {\n\t\t\t\t\t\t\t\t// 到达最后一页，自动停止\n\t\t\t\t\t\t\t\tclearInterval(self.autoFlipInterval);\n\t\t\t\t\t\t\t\tself.autoFlipEnabled = false;\n\t\t\t\t\t\t\t\tself.autoFlipInterval = null;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttoNextPage();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, currentInterval * 1000);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\" x-init=\"(() => {\n\t\t\t\t// 确保 intervalSeconds 是数字类型\n\t\t\t\tif (typeof intervalSeconds !== 'number') {\n\t\t\t\t\tintervalSeconds = parseInt(intervalSeconds) || 3;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 页面卸载时清理定时器\n\t\t\t\twindow.addEventListener('beforeunload', () => {\n\t\t\t\t\tif (autoFlipInterval) {\n\t\t\t\t\t\tclearInterval(autoFlipInterval);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t})()\" class=\"w-full comigo_plugin\"><!-- 自动翻页切换按钮 --><button type=\"button\" @click=\"\n\t\t\t\t\tif (autoFlipEnabled) {\n\t\t\t\t\t\t// 停止自动翻页\n\t\t\t\t\t\tif (autoFlipInterval) {\n\t\t\t\t\t\t\tclearInterval(autoFlipInterval);\n\t\t\t\t\t\t\tautoFlipInterval = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tautoFlipEnabled = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// 开始自动翻页\n\t\t\t\t\t\tautoFlipEnabled = true;\n\t\t\t\t\t\tstartAutoFlip();\n\t\t\t\t\t}\n\t\t\t\t\" :class=\"autoFlipEnabled ? 'bg-green-300 hover:bg-green-400' : 'bg-blue-200 hover:bg-indigo-300'\" class=\"w-full mb-2 text-sm text-center inline-flex items-center justify-center px-2.5 py-2 border rounded text-black font-semibold focus:outline-none focus:ring transition delay-150 duration-300 ease-in-out \"><span x-text=\"autoFlipEnabled ? i18next.t('auto_flip_pause_flip') : i18next.t('auto_flip_start_flip')\"></span></button><!-- 间隔时间设置 --><div class=\"relative w-full my-2 border-2 border-gray-500 dark:border-gray-200 rounded px-2 py-1.5\"><label for=\"autoFlipIntervalSeconds\" class=\"block w-full mb-0 font-medium\" x-text=\"i18next.t('auto_flip_interval') + ' ' + intervalSeconds + ' ' + i18next.t('auto_flip_seconds')\"></label> <input id=\"autoFlipIntervalSeconds\" type=\"range\" min=\"1\" max=\"120\" x-model.number=\"intervalSeconds\" @input=\"\n\t\t\t\t\t\tintervalSeconds = parseInt($event.target.value) || 3;\n\t\t\t\t\t\t// 如果正在运行，重新启动定时器以应用新的间隔时间\n\t\t\t\t\t\tif (autoFlipEnabled) {\n\t\t\t\t\t\t\tstartAutoFlip();\n\t\t\t\t\t\t}\n\t\t\t\t\t\" step=\"1\" class=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700\"></div></div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
