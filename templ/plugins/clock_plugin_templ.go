// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.977
package plugins

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import (
	"github.com/labstack/echo/v4"
	"github.com/yumenaka/comigo/config"
)

// ClockPlugin 在右下角显示当前时间的插件（支持拖动）
func ClockPlugin(c echo.Context) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		if config.GetCfg().EnablePlugin && config.GetCfg().IsPluginEnabled("clock") {
			if config.GetCfg().Debug {
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<script>\n\t\t\t\tconsole.log(\"时钟插件已启用\");\n\t\t\t</script>")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, " <div x-data=\"{ \n\t\t\t\tcurrentTime: new Date().toLocaleTimeString(),\n\t\t\t\tisDragging: false,\n\t\t\t\tdragPointerId: null,\n\t\t\t\tstartX: 0,\n\t\t\t\tstartY: 0,\n\t\t\t\toffsetX: 0,\n\t\t\t\toffsetY: 0,\n\t\t\t\tpendingClientX: 0,\n\t\t\t\tpendingClientY: 0,\n\t\t\t\trafScheduled: false,\n\t\t\t\tleft: $persist('auto').as('clockPluginLeft'),\n\t\t\t\ttop: $persist('auto').as('clockPluginTop'),\n\t\t\t\tschedulePositionUpdate($el) {\n\t\t\t\t\tif (this.rafScheduled) return;\n\t\t\t\t\tthis.rafScheduled = true;\n\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\tthis.rafScheduled = false;\n\t\t\t\t\t\tif (!this.isDragging) return;\n\t\t\t\t\t\tconst newLeft = this.pendingClientX - this.offsetX;\n\t\t\t\t\t\tconst newTop = this.pendingClientY - this.offsetY;\n\n\t\t\t\t\t\t// 限制在视口内\n\t\t\t\t\t\tconst maxLeft = window.innerWidth - $el.offsetWidth;\n\t\t\t\t\t\tconst maxTop = window.innerHeight - $el.offsetHeight;\n\n\t\t\t\t\t\tthis.left = Math.max(0, Math.min(newLeft, maxLeft)) + 'px';\n\t\t\t\t\t\tthis.top = Math.max(0, Math.min(newTop, maxTop)) + 'px';\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tstopDragging($el) {\n\t\t\t\t\tthis.isDragging = false;\n\t\t\t\t\tif (typeof this.dragPointerId === 'number' && $el && $el.releasePointerCapture) {\n\t\t\t\t\t\ttry { $el.releasePointerCapture(this.dragPointerId); } catch (e) {}\n\t\t\t\t\t}\n\t\t\t\t\tthis.dragPointerId = null;\n\t\t\t\t}\n\t\t\t}\" x-init=\"\n\t\t\t\t// 更新时间\n\t\t\t\tsetInterval(() => { currentTime = new Date().toLocaleTimeString(); }, 1000);\n\t\t\t\t\n\t\t\t\t// 初始化位置：如果未设置过，默认在右下角\n\t\t\t\tif (left === 'auto' || top === 'auto') {\n\t\t\t\t\t// 延迟设置，确保页面已加载\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tconst rect = $el.getBoundingClientRect();\n\t\t\t\t\t\tleft = (window.innerWidth - rect.width - 16) + 'px';\n\t\t\t\t\t\ttop = (window.innerHeight - rect.height - 16) + 'px';\n\t\t\t\t\t}, 100);\n\t\t\t\t}\n\t\t\t\" @pointerdown.prevent=\"\n\t\t\t\tif (!window.PointerEvent) return;\n\t\t\t\tisDragging = true;\n\t\t\t\tdragPointerId = $event.pointerId;\n\t\t\t\tstartX = $event.clientX;\n\t\t\t\tstartY = $event.clientY;\n\t\t\t\tconst rect = $el.getBoundingClientRect();\n\t\t\t\toffsetX = startX - rect.left;\n\t\t\t\toffsetY = startY - rect.top;\n\n\t\t\t\t// 让后续 move/up 更可靠（尤其是快速拖动/触控设备）\n\t\t\t\tif ($el.setPointerCapture) {\n\t\t\t\t\ttry { $el.setPointerCapture(dragPointerId); } catch (e) {}\n\t\t\t\t}\n\n\t\t\t\tpendingClientX = $event.clientX;\n\t\t\t\tpendingClientY = $event.clientY;\n\t\t\t\tschedulePositionUpdate($el);\n\t\t\t\" @pointermove.window=\"\n\t\t\t\tif (!window.PointerEvent) return;\n\t\t\t\tif (!isDragging) return;\n\t\t\t\tif (dragPointerId !== null && $event.pointerId !== dragPointerId) return;\n\t\t\t\tpendingClientX = $event.clientX;\n\t\t\t\tpendingClientY = $event.clientY;\n\t\t\t\tschedulePositionUpdate($el);\n\t\t\t\" @pointerup.window=\"\n\t\t\t\tif (!window.PointerEvent) return;\n\t\t\t\tif (!isDragging) return;\n\t\t\t\tif (dragPointerId !== null && $event.pointerId !== dragPointerId) return;\n\t\t\t\tstopDragging($el);\n\t\t\t\" @pointercancel.window=\"\n\t\t\t\tif (!window.PointerEvent) return;\n\t\t\t\tif (!isDragging) return;\n\t\t\t\tif (dragPointerId !== null && $event.pointerId !== dragPointerId) return;\n\t\t\t\tstopDragging($el);\n\t\t\t\" @mousedown.prevent=\"\n\t\t\t\tif (window.PointerEvent) return;\n\t\t\t\tisDragging = true;\n\t\t\t\tdragPointerId = 'mouse';\n\t\t\t\tstartX = $event.clientX;\n\t\t\t\tstartY = $event.clientY;\n\t\t\t\tconst rect = $el.getBoundingClientRect();\n\t\t\t\toffsetX = startX - rect.left;\n\t\t\t\toffsetY = startY - rect.top;\n\t\t\t\tpendingClientX = $event.clientX;\n\t\t\t\tpendingClientY = $event.clientY;\n\t\t\t\tschedulePositionUpdate($el);\n\t\t\t\" @mousemove.window=\"\n\t\t\t\tif (window.PointerEvent) return;\n\t\t\t\tif (!isDragging) return;\n\t\t\t\tpendingClientX = $event.clientX;\n\t\t\t\tpendingClientY = $event.clientY;\n\t\t\t\tschedulePositionUpdate($el);\n\t\t\t\" @mouseup.window=\"\n\t\t\t\tif (window.PointerEvent) return;\n\t\t\t\tif (!isDragging) return;\n\t\t\t\tstopDragging($el);\n\t\t\t\" @blur.window=\"stopDragging($el)\" :style=\"{ left: left, top: top, bottom: left === 'auto' ? 'auto' : 'unset', right: left === 'auto' ? 'auto' : 'unset' }\" class=\"comigo_plugin fixed px-3 py-2 text-sm font-mono text-base-content bg-base-200/60 border border-black/50 rounded-lg shadow-lg z-50 cursor-move select-none\" :class=\"{ 'opacity-40': isDragging }\"><span x-text=\"currentTime\"></span></div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
