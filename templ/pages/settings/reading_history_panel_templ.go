// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.977
package settings

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

// ReadingHistoryPanel 设置页面的完整阅读历史面板（带服务端分页）
// 调用 /api/reading-history?page=X&page_size=Y 获取数据
func ReadingHistoryPanel() templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<div id=\"reading_history\" x-data=\"{\n\t\t\tcollapsed: $persist(false).as('settings_reading_history_collapsed'),\n\t\t\tbookmarks: [],\n\t\t\tloading: false,\n\t\t\tdeleting: {},\n\t\t\tcurrentPage: 1,\n\t\t\tpageSize: 5,\n\t\t\ttotalCount: 0,\n\t\t\ttotalPages: 1,\n\t\t\t// 获取指定页的数据\n\t\t\tasync fetchPage(page) {\n\t\t\t\tthis.loading = true;\n\t\t\t\ttry {\n\t\t\t\t\tconst response = await fetch('/api/reading-history?page=' + page + '&page_size=' + this.pageSize);\n\t\t\t\t\tif (response.ok) {\n\t\t\t\t\t\tconst data = await response.json();\n\t\t\t\t\t\t// 后端已完成过滤和排序，直接使用返回的数据\n\t\t\t\t\t\tthis.bookmarks = data.items || [];\n\t\t\t\t\t\tthis.totalCount = data.total_count || 0;\n\t\t\t\t\t\tthis.totalPages = data.total_pages || 1;\n\t\t\t\t\t\tthis.currentPage = data.page || 1;\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('Failed to load reading history:', error);\n\t\t\t\t} finally {\n\t\t\t\t\tthis.loading = false;\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 跳转到指定页\n\t\t\tgoToPage(page) {\n\t\t\t\tif (page >= 1 && page <= this.totalPages && page !== this.currentPage) {\n\t\t\t\t\tthis.fetchPage(page);\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 删除书签\n\t\t\tasync deleteBookmark(item, index) {\n\t\t\t\tif (!confirm(i18next.t('confirm_delete_bookmark'))) return;\n\t\t\t\tconst key = item.book_info.id + '_' + item.book_mark.mark_type + '_' + item.book_mark.page_index;\n\t\t\t\tthis.deleting[key] = true;\n\t\t\t\ttry {\n\t\t\t\t\tconst url = '/api/delete-bookmark?book_id=' + encodeURIComponent(item.book_info.id) +\n\t\t\t\t\t\t'&mark_type=' + encodeURIComponent(item.book_mark.mark_type) +\n\t\t\t\t\t\t'&page_index=' + item.book_mark.page_index;\n\t\t\t\t\tconst response = await fetch(url, { method: 'DELETE' });\n\t\t\t\t\tif (response.ok) {\n\t\t\t\t\t\t// 从列表中移除\n\t\t\t\t\t\tthis.bookmarks.splice(index, 1);\n\t\t\t\t\t\tthis.totalCount--;\n\t\t\t\t\t\tif (typeof window.showToast === 'function') {\n\t\t\t\t\t\t\twindow.showToast(i18next.t('bookmark_deleted'), 'success');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// 如果当前页没有数据了，回到上一页\n\t\t\t\t\t\tif (this.bookmarks.length === 0 && this.currentPage > 1) {\n\t\t\t\t\t\t\tthis.fetchPage(this.currentPage - 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst err = await response.text();\n\t\t\t\t\t\tconsole.error('Delete bookmark failed:', err);\n\t\t\t\t\t\tif (typeof window.showToast === 'function') {\n\t\t\t\t\t\t\twindow.showToast('Delete failed', 'error');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('Delete bookmark error:', error);\n\t\t\t\t} finally {\n\t\t\t\t\tdelete this.deleting[key];\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 计算可见的页码列表\n\t\t\tget visiblePages() {\n\t\t\t\tconst pages = [];\n\t\t\t\tconst total = this.totalPages;\n\t\t\t\tconst current = this.currentPage;\n\t\t\t\tconst delta = 2;\n\t\t\t\t\n\t\t\t\tfor (let i = 1; i <= total; i++) {\n\t\t\t\t\tif (i === 1 || i === total || (i >= current - delta && i <= current + delta)) {\n\t\t\t\t\t\tpages.push(i);\n\t\t\t\t\t} else if (pages[pages.length - 1] !== '...') {\n\t\t\t\t\t\tpages.push('...');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn pages;\n\t\t\t}\n\t\t}\" x-init=\"fetchPage(1)\" class=\"flex flex-col justify-start w-full pl-2 pr-4 py-2 mx-2 my-1 font-semibold border rounded shadow-md hover:shadow-2xl items-left bg-base-100 text-base-content border-slate-400\"><!-- 折叠/展开按钮 --><button @click=\"collapsed = !collapsed\" class=\"flex justify-between items-center w-full cursor-pointer px-2 py-1.5\"><!-- 折叠指示图标（左） --><svg class=\"w-5 h-5 transition-transform\" :class=\"{ '-rotate-90': collapsed }\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 10 6\"><path stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"m1 1 4 4 4-4\"></path></svg><!-- 标题 --><div class=\"flex-1 flex flex-row justify-center items-center gap-2\"><span class=\"text-center font-semibold\" x-text=\"i18next.t('reading_history')\"></span> <span x-show=\"totalCount > 0\" class=\"text-sm font-normal text-gray-500\" x-text=\"'(' + totalCount + ')'\"></span></div><!-- 折叠指示图标（右） --><svg class=\"w-5 h-5 transition-transform\" :class=\"{ 'rotate-90': collapsed }\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 10 6\"><path stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"m1 1 4 4 4-4\"></path></svg></button><hr x-show=\"!collapsed\" class=\"my-1 mx-4 h-2 border-gray-600 border-dashed dark:border-gray-200\"><!-- 内容区域（可折叠） --><div x-show=\"!collapsed\" x-transition><!-- 分页控件（加载时保持显示，按钮禁用） --><div x-show=\"totalPages > 1\" class=\"flex flex-col items-center gap-1 pb-1 border-gray-500 dark:border-gray-200\"><div class=\"flex justify-center items-center gap-2\"><!-- 上一页 --><button @click=\"goToPage(currentPage - 1)\" :disabled=\"loading || currentPage === 1\" class=\"px-3 py-1 rounded border border-gray-500 dark:border-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"><svg class=\"w-5 h-5\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 19l-7-7 7-7\"></path></svg></button><!-- 页码 --><template x-for=\"page in visiblePages\" :key=\"page\"><button x-show=\"page !== '...'\" @click=\"goToPage(page)\" :disabled=\"loading\" :class=\"currentPage === page ? 'bg-blue-500 text-white border-blue-500' : 'border-gray-500 dark:border-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800'\" class=\"px-3 py-1 rounded border transition-colors min-w-10 disabled:opacity-50 disabled:cursor-not-allowed\" x-text=\"page\"></button> <span x-show=\"page === '...'\" class=\"px-2 text-gray-500\">...</span></template><!-- 下一页 --><button @click=\"goToPage(currentPage + 1)\" :disabled=\"loading || currentPage === totalPages\" class=\"px-3 py-1 rounded border border-gray-500 dark:border-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"><svg class=\"w-5 h-5\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"></path></svg></button></div><!-- 页面信息 --><div class=\"text-center text-sm text-gray-500 font-normal\"><span x-text=\"i18next.t('page') + ' ' + currentPage + ' / ' + totalPages\"></span></div></div><!-- 暂无阅读历史 --><div x-show=\"!loading && bookmarks.length === 0\" class=\"flex flex-col justify-center items-center w-full py-8 text-gray-500\"><svg class=\"w-16 h-16 mb-4 text-gray-300\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25\"></path></svg> <span x-text=\"i18next.t('no_reading_history')\"></span></div><!-- 书签列表（加载时保持显示） --><div x-show=\"bookmarks.length > 0\" class=\"space-y-3 p-2\"><template x-for=\"(item, index) in bookmarks\" :key=\"item.book_info?.id + '_' + item.book_mark?.mark_type + '_' + item.book_mark?.page_index + '_' + index\"><div class=\"flex flex-col p-3 rounded-lg border-2 border-gray-500 dark:border-gray-200 transition-all\"><!-- 上部：封面 + 信息（大屏幕右侧显示按钮） --><div class=\"flex items-start gap-3\"><!-- 封面 --><div class=\"w-14 h-20 sm:w-16 sm:h-22 bg-cover bg-center rounded-lg shrink-0 border-2 border-gray-500 dark:border-gray-200 shadow-sm\" :style=\"'background-image: url(' + (item.book_info.cover.url.includes('api/get_file?') ? item.book_info.cover.url + '&resize_height=160&no-cache=true' : item.book_info.cover.url) + ')'\"></div><!-- 信息 --><div class=\"flex-1 min-w-0\"><div class=\"flex items-center gap-2 flex-wrap\"><span class=\"font-semibold text-sm sm:text-base truncate\" x-text=\"item.book_info.title || i18next.t('unknown')\"></span></div><div class=\"text-xs sm:text-sm text-gray-500 mt-1 space-y-0.5\"><div class=\"flex items-center gap-1 sm:gap-2 flex-wrap\"><span x-text=\"i18next.t('page') + ' ' + item.book_mark.page_index + ' / ' + item.book_info.page_count\"></span> <span class=\"px-1.5 py-0.5 text-xs bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300 rounded-full\" x-text=\"Math.round((item.book_mark.page_index / item.book_info.page_count) * 100) + '%'\"></span><!-- 书签类型标识 --><span x-show=\"item.book_mark.mark_type === 'user'\" class=\"shrink-0 px-1.5 py-0.5 text-xs font-medium bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300 rounded\" x-text=\"i18next.t('manual_bookmark')\"></span> <span x-show=\"item.book_mark.mark_type === 'auto' || !item.book_mark.mark_type\" class=\"shrink-0 px-1.5 py-0.5 text-xs font-medium bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 rounded\" x-text=\"i18next.t('auto_bookmark')\"></span></div><div class=\"flex items-center gap-2 text-xs\" x-show=\"item.book_mark.updated_at\"><span x-text=\"new Date(item.book_mark.updated_at).toLocaleString()\"></span></div></div><!-- 阅读进度条 --><div class=\"w-full h-1.5 mt-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\"><div class=\"h-full bg-linear-to-r from-blue-400 to-blue-600 transition-all duration-300\" :style=\"'width: ' + Math.round((item.book_mark.page_index / item.book_info.page_count) * 100) + '%'\"></div></div></div><!-- 操作按钮（大屏幕显示在右侧） --><div class=\"hidden sm:flex flex-col gap-2 shrink-0\"><!-- 继续阅读按钮 --><a :href=\"$store.global.getReadURL(item.book_info.id, item.book_mark.page_index)\" class=\"flex h-10 items-center justify-center gap-1 px-3 py-1.5 text-sm border shadow-lg text-black font-semibold focus:ring rounded bg-blue-200  hover:bg-indigo-300 transition-colors\"><svg class=\"w-4 h-4\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25\"></path></svg> <span x-text=\"i18next.t('continue_reading')\"></span></a><!-- 删除按钮 --><button @click=\"deleteBookmark(item, index)\" :disabled=\"deleting[item.book_info.id + '_' + item.book_mark.mark_type + '_' + item.book_mark.page_index] === true\" class=\"flex h-10 items-center justify-center gap-1 px-3 py-1.5 text-sm border shadow-lg text-black font-semibold focus:ring bg-red-300 rounded hover:bg-red-400 transition-colors\"><svg class=\"w-4 h-4\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"></path></svg> <span x-text=\"i18next.t('delete_record')\"></span></button></div></div><!-- 操作按钮（小屏幕显示在底部） --><div class=\"flex sm:hidden gap-2 mt-3 pt-3 border-t border-gray-300 dark:border-gray-600\"><!-- 继续阅读按钮 --><a :href=\"$store.global.getReadURL(item.book_info.id, item.book_mark.page_index)\" class=\"flex-1 flex items-center justify-center gap-1 px-3 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors\"><svg class=\"w-4 h-4\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25\"></path></svg> <span x-text=\"i18next.t('continue_reading')\"></span></a><!-- 删除按钮 --><button @click=\"deleteBookmark(item, index)\" :disabled=\"deleting[item.book_info.id + '_' + item.book_mark.mark_type + '_' + item.book_mark.page_index] === true\" class=\"flex-1 flex items-center justify-center gap-1 px-3 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"><svg class=\"w-4 h-4\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"></path></svg> <span x-text=\"i18next.t('delete_record')\"></span></button></div></div></template></div></div></div>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
