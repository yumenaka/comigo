# ============================================================================
# Docker Compose 配置文件 - Comigo 漫画/书籍浏览服务器
# ============================================================================
# 使用方法：
#   启动服务: docker-compose up -d
#   查看日志: docker-compose logs -f
#   停止服务: docker-compose down
#   重启服务: docker-compose restart
# ============================================================================

version: '3.8'

services:
  comigo:
    # 使用预构建的镜像
    image: yumenaka/comigo:latest
    
    # 或者从本地 Dockerfile 构建
    # build:
    #   context: ../../
    #   dockerfile: sample/docker/Dockerfile
    #   args:
    #     VERSION: v1.2.4
    
    container_name: comigo
    
    # 重启策略
    restart: unless-stopped
    
    # 端口映射
    ports:
      - "1234:1234"
    
    # 环境变量配置
    environment:
      # 服务端口（默认 1234）
      - COMIGO_PORT=1234

      # 用户认证（可选，启用后需要登录）
      # - COMIGO_USERNAME=admin
      # - COMIGO_PASSWORD=your_secure_password
      
      # 启用文件上传功能（默认 true）
      - COMIGO_ENABLE_UPLOAD=true
      
      # 只读模式（禁止网页端更改配置或上传文件）
      # - COMIGO_READ_ONLY=false
      
      # 终端输出语言（auto/zh/en/ja，默认 auto）
      - COMIGO_LANGUAGE=auto
      
      # 最大扫描深度（默认 5）
      # - COMIGO_MAX_DEPTH=5
      
      # 最少图片数量（默认 1）
      # - COMIGO_MIN_IMAGE=1
      
      
      # 自动重新扫描间隔（分钟，0 为禁用）
      # - COMIGO_AUTO_RESCAN_MIN=0
      
      # 只在本机提供服务，不对外共享
      # - COMIGO_LOCAL=false
      
      # 启用插件系统
      # - COMIGO_ENABLE_PLUGIN=true
      
      # 时区设置
      - TZ=Asia/Shanghai
    
    # 数据卷挂载
    volumes:
      # 书库数据目录（必需）
      # 将您的漫画/书籍目录挂载到 /data
      - ./books:/data
      
      # 配置文件目录（可选）
      # 如果需要持久化配置文件，可以挂载此目录
      # 配置文件路径: /root/.config/comigo/config.toml
      - ./config:/root/.config/comigo
      
      # 自定义插件目录（可选）
      # 如果有自定义插件，可以挂载到项目的插件目录
      # 注意：需要在配置中启用插件并指定插件目录
      # - ./plugins:/data/plugins
    
    # 健康检查
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:1234/"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s
    
    # 资源限制（可选）
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '2'
    #       memory: 1G
    #     reservations:
    #       cpus: '0.5'
    #       memory: 256M
    
    # 网络配置
    # networks:
    #   - comigo-network

# 自定义网络（可选）
# networks:
#   comigo-network:
#     driver: bridge

# 命名卷（可选）
# volumes:
#   comigo-data:
#   comigo-config:
#   comigo-cache:
